{"version":3,"file":"index.js","sources":["../../../../common/src/validate/index.js"],"sourcesContent":["// import default_schema from \"./schema\";\nimport keyword_list from \"./keywords\";\nimport Ajv2019 from \"ajv/dist/2019\";\nimport addFormats from \"ajv-formats\";\nimport AjvErrors from \"ajv-errors\";\nimport AjvKeywords from \"ajv-keywords\";\n\nimport _genSchema from \"./_genSchema\";\nimport _check from \"./_check\";\n\n// 封裝一個處理錯誤的校驗器\nclass myAjv extends Ajv2019 {\n  #schemaList = undefined;\n  _validates = {};\n  constructor(dataList, options) {\n    //  建立ajv instance\n    super({\n      allErrors: true,\n      $data: true,\n    });\n    AjvKeywords(this);\n    //  添加功能:自定義錯誤提示\n    AjvErrors(this);\n    //  添加format關鍵字\n    addFormats(this);\n\n    //  添加axios(async性質的schema需要用到)\n    if (options?.axios) {\n      this.$$axios = options.axios;\n    }\n\n    //  添加自定義關鍵字\n    keyword_list.forEach((keyword) => {\n      this.addKeyword(keyword);\n    });\n\n    for (let data of dataList) {\n      let { name } = data;\n      const schema = _genSchema(data);\n      this.addSchema(schema);\n      if (!data.json.type) {\n        continue;\n      }\n      let validate = this.getSchema(schema.$id);\n      this._validates[name] = _check.bind(validate);\n    }\n  }\n}\n\nfunction genValidator(dataList, options) {\n  const { _validates } = new myAjv(dataList, options);\n  return _validates;\n}\n\nimport attributes from \"./attributes\";\n\nexport default { genValidator, attributes };\n"],"names":["Ajv2019","AjvKeywords","AjvErrors","addFormats","keyword_list","_genSchema","_check","attributes"],"mappings":";;;;;;;;;;;;;;;;;;AAWA,MAAM,cAAcA,MAAAA,QAAQ;AAAA,EAG1B,YAAY,UAAU,SAAS;AAE7B,UAAM;AAAA,MACJ,WAAW;AAAA,MACX,OAAO;AAAA,IACb,CAAK;AAPH;AACA,sCAAa,CAAE;AAObC,YAAAA,QAAY,IAAI;AAEhBC,YAAAA,QAAU,IAAI;AAEdC,YAAAA,QAAW,IAAI;AAGf,QAAI,mCAAS,OAAO;AAClB,WAAK,UAAU,QAAQ;AAAA,IAC7B;AAGIC,oBAAa,QAAQ,CAAC,YAAY;AAChC,WAAK,WAAW,OAAO;AAAA,IAC7B,CAAK;AAED,aAAS,QAAQ,UAAU;AACzB,UAAI,EAAE,KAAI,IAAK;AACf,YAAM,SAASC,WAAU,QAAC,IAAI;AAC9B,WAAK,UAAU,MAAM;AACrB,UAAI,CAAC,KAAK,KAAK,MAAM;AACnB;AAAA,MACR;AACM,UAAI,WAAW,KAAK,UAAU,OAAO,GAAG;AACxC,WAAK,WAAW,IAAI,IAAIC,OAAAA,QAAO,KAAK,QAAQ;AAAA,IAClD;AAAA,EACA;AACA;AAnCE;AAqCF,SAAS,aAAa,UAAU,SAAS;AACvC,QAAM,EAAE,WAAY,IAAG,IAAI,MAAM,UAAU,OAAO;AAClD,SAAO;AACT;AAIA,MAAA,QAAe,EAAE,cAAcC,YAAAA,WAAAA,QAAY;;"}
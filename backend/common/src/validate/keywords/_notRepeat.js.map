{"version":3,"file":"_notRepeat.js","sources":["../../../../../common/src/validate/keywords/_notRepeat.js"],"sourcesContent":["import ERROR_PARAMS from \"../_ERROR_PARAMS\";\n\nconst keyword = \"_notRepeat\";\nconst message = \"沒有要改就別鬧了\";\n\nfunction validate(schema, data, parentSchema, dataCtx) {\n  let { _old } = data;\n  if (!_old) {\n    console.warn(\"來自 keyword _notEmpty 的警告，驗證數據未提供 _old\");\n    return true;\n  }\n  let error = { keyword: \"myKeyword\", message };\n  // 蒐集別名\n  const alias_map = schema.reduce((map, item) => {\n    if (typeof item === \"string\") {\n      map.set(item, item);\n    } else if (Array.isArray(item)) {\n      const [propertyInData, propertyIn_old] = item;\n      map.set(propertyInData, propertyIn_old);\n    }\n    return map;\n  }, new Map());\n  let params_errors = Object.entries(data).reduce((acc, [prorperty, value]) => {\n    let valid = true;\n    // 確認data是否有schema要校驗的屬性\n    // 確認data是否有schema要校驗的別名屬性\n    if (\n      alias_map.has(prorperty) &&\n      _old[alias_map.get(prorperty)] !== \"\" &&\n      _old[alias_map.get(prorperty)] !== null\n    ) {\n      // if (schema.includes(prorperty)) {\n      let _value = _old[alias_map.get(prorperty)];\n      if (typeof _value === \"number\") {\n        value *= 1;\n      }\n      valid = value !== _value;\n    }\n    if (!valid) {\n      acc.push({\n        keyword,\n        params: { [ERROR_PARAMS._notRepeat]: prorperty },\n      });\n    }\n    return acc;\n  }, []);\n  if (params_errors.length) {\n    error.params = { errors: params_errors };\n    validate.errors = [error];\n  }\n  return !params_errors.length;\n}\n\nexport default {\n  keyword,\n  //    data type\n  type: \"object\",\n  //    schema 針對此 keyword 設定的格式限制\n  schemaType: \"array\",\n  validate,\n  errors: true,\n};\n"],"names":["ERROR_PARAMS"],"mappings":";;;AAEA,MAAM,UAAU;AAChB,MAAM,UAAU;AAEhB,SAAS,SAAS,QAAQ,MAAM,cAAc,SAAS;AACrD,MAAI,EAAE,KAAI,IAAK;AACf,MAAI,CAAC,MAAM;AACT,YAAQ,KAAK,uCAAuC;AACpD,WAAO;AAAA,EACX;AACE,MAAI,QAAQ,EAAE,SAAS,aAAa,QAAS;AAE7C,QAAM,YAAY,OAAO,OAAO,CAAC,KAAK,SAAS;AAC7C,QAAI,OAAO,SAAS,UAAU;AAC5B,UAAI,IAAI,MAAM,IAAI;AAAA,IACnB,WAAU,MAAM,QAAQ,IAAI,GAAG;AAC9B,YAAM,CAAC,gBAAgB,cAAc,IAAI;AACzC,UAAI,IAAI,gBAAgB,cAAc;AAAA,IAC5C;AACI,WAAO;AAAA,EACX,GAAK,oBAAI,IAAG,CAAE;AACZ,MAAI,gBAAgB,OAAO,QAAQ,IAAI,EAAE,OAAO,CAAC,KAAK,CAAC,WAAW,KAAK,MAAM;AAC3E,QAAI,QAAQ;AAGZ,QACE,UAAU,IAAI,SAAS,KACvB,KAAK,UAAU,IAAI,SAAS,CAAC,MAAM,MACnC,KAAK,UAAU,IAAI,SAAS,CAAC,MAAM,MACnC;AAEA,UAAI,SAAS,KAAK,UAAU,IAAI,SAAS,CAAC;AAC1C,UAAI,OAAO,WAAW,UAAU;AAC9B,iBAAS;AAAA,MACjB;AACM,cAAQ,UAAU;AAAA,IACxB;AACI,QAAI,CAAC,OAAO;AACV,UAAI,KAAK;AAAA,QACP;AAAA,QACA,QAAQ,EAAE,CAACA,sBAAa,UAAU,GAAG,UAAW;AAAA,MACxD,CAAO;AAAA,IACP;AACI,WAAO;AAAA,EACR,GAAE,EAAE;AACL,MAAI,cAAc,QAAQ;AACxB,UAAM,SAAS,EAAE,QAAQ,cAAe;AACxC,aAAS,SAAS,CAAC,KAAK;AAAA,EAC5B;AACE,SAAO,CAAC,cAAc;AACxB;AAEA,MAAe,aAAA;AAAA,EACb;AAAA;AAAA,EAEA,MAAM;AAAA;AAAA,EAEN,YAAY;AAAA,EACZ;AAAA,EACA,QAAQ;AACV;;"}
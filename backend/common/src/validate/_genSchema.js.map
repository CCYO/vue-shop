{"version":3,"file":"_genSchema.js","sources":["../../../../common/src/validate/_genSchema.js"],"sourcesContent":["export default function ({ host, name, json }) {\n  return {\n    ..._init(json),\n    $id: `${host}/${name}.json`,\n  };\n}\n\nfunction _init(json) {\n  let kvPairs;\n  let result;\n  if (json.definitions) {\n    kvPairs = json.definitions;\n    result = { definitions: {} };\n  } else if (json.properties) {\n    let { properties, ...others } = _addErrorMessage(json);\n    kvPairs = properties;\n    result = { ...others, properties: {} };\n  } else {\n    return json;\n  }\n  const theValue = Object.entries(kvPairs).reduce((acc, [key, values]) => {\n    acc[key] = _addErrorMessage(values);\n    return acc;\n  }, {});\n\n  if (result.definitions) {\n    result.definitions = theValue;\n  } else {\n    result.properties = theValue;\n  }\n  return result;\n}\n\nfunction _addErrorMessage(json) {\n  // 複製一份，避免直接更改到原本引用的數據\n  const res = { ...json };\n  if (!res.errorMessage) {\n    res.errorMessage = {};\n  }\n  const MSG = res.errorMessage;\n  for (let key in res) {\n    const VALUE = res[key];\n    if (key === \"regexp\") {\n      res.regexp = res.regexp.toString();\n    } else if (key === \"errorMessage\" || res.errorMessage[key]) {\n      continue;\n    } else if (key === \"type\") {\n      MSG[key] = `必須是${VALUE}類型`;\n    }\n    if (key === \"minLength\" || key === \"maxLength\") {\n      if (\n        ![res.minLength, res.maxLength].some((item) => typeof item !== \"number\")\n      ) {\n        MSG.minLength =\n          MSG.maxLength = `必須介於${res.minLength}-${res.maxLength}個字符`;\n      } else if (key === \"minLength\") {\n        MSG[key] = `必須大於${VALUE}個字符`;\n      } else {\n        MSG[key] = `必須小於${VALUE}個字符`;\n      }\n    } else if (key === \"minimum\" || key === \"maximum\") {\n      if (\n        ![res.minimum, res.maximum].some((item) => typeof item !== \"number\")\n      ) {\n        MSG.minimum = MSG.maximum = `必須介於${res.minimum}-${res.maximum}之間`;\n      } else if (key === \"minimum\") {\n        MSG[key] = `必須大於${VALUE}`;\n      } else {\n        MSG[key] = `必須小於${VALUE}`;\n      }\n    } else if (key === \"format\") {\n      MSG[key] = `必須符合${VALUE}格式`;\n    } else if (key === \"enum\") {\n      MSG[key] = `必須符合${VALUE}其中一種格式`;\n    } else if (key === \"required\") {\n      MSG[key] = \"必填\";\n    } else if (key === \"additionalProperties\") {\n      MSG[key] = `不被認列的數據`;\n    } else if (key === \"minProperties\") {\n      MSG[key] = `必須有${VALUE}項以上的校驗數據`;\n    } else if (key === \"minItems\") {\n      MSG[key] = `必須包含${VALUE}個以上的值`;\n    } else if (key === \"uniqueItems\") {\n      MSG[key] = `不可包含重複值`;\n    } else if (key === \"items\") {\n      if (Array.isArray(VALUE)) {\n        continue;\n      }\n      const { type } = VALUE;\n      // MSG[key] = { type: `必須由${type}類型的值組成` };\n      MSG[key] = [`必須由${type}類型的值組成`];\n    }\n  }\n  if (!Object.getOwnPropertyNames(res.errorMessage).length) {\n    delete res.errorMessage;\n  }\n  return res;\n}\n"],"names":[],"mappings":"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"}